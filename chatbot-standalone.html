<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bubble AI Investment Assistant</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="chatbot-styles.css" />
  <link rel="icon" href="bubble-favicon.svg" type="image/svg+xml" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="translations.js"></script>
  <script src="chatbot-logic.js" defer></script>
</head>
<body>
  <header class="chatbot-header">
    <div class="header-left">
      <div class="brand">
        <img src="bubble-logo-single.svg" alt="Bubble Logo" class="chatbot-logo" />
        <span class="chatbot-title">Bubble AI</span>
      </div>
    </div>
    
    <div class="header-center">
      <div class="chatbot-status" id="chatbot-status">â— Online</div>
    </div>
    
    <div class="header-right">
      <div class="language-switcher">
        <button id="en-switch" class="active">EN</button>
        <span>|</span>
        <button id="fr-switch">FR</button>
      </div>
      
      <div class="auth-buttons">
        <button class="btn-secondary" data-translate="header.signIn">Sign In</button>
        <button class="btn-primary" data-translate="header.login">Log In</button>
      </div>
      
      <div class="action-buttons">
        <button class="btn-accent" id="join-waitlist-btn" data-translate="header.joinWaitlist">Join Waitlist</button>
        <button class="btn-outline" id="learn-more-btn" data-translate="header.learnMore">Learn More</button>
      </div>
    </div>
  </header>

  <div class="chatbot-layout">
    <aside class="chatbot-sidebar" id="chatbot-sidebar">
      <!-- Enhanced History Section -->
      <div class="sidebar-section chatbot-history">
        <div class="section-header">
          <h3 data-translate="sidebar.history">Chat History</h3>
          <button id="new-chat-btn" class="btn-new-chat" data-translate="sidebar.newChat">+ New Chat</button>
        </div>
        <div id="chatbot-history-list" class="history-list">
          <!-- History items will be populated by JavaScript -->
        </div>
      </div>
      
      <!-- Portfolio Widget -->
      <div class="sidebar-section chatbot-portfolio">
        <h3 data-translate="sidebar.portfolio">Portfolio Overview</h3>
        <div id="chatbot-portfolio-widget" class="portfolio-widget">
          <!-- Mock portfolio data for demo -->
          <div class="portfolio-stat">
            <span class="stat-label">Total Value</span>
            <span class="stat-value">$127,834.56</span>
            <span class="stat-change positive">+2.34%</span>
          </div>
          <div class="portfolio-stat">
            <span class="stat-label">Today's P&L</span>
            <span class="stat-value">+$2,891.23</span>
            <span class="stat-change positive">+2.31%</span>
          </div>
          <div class="portfolio-stat">
            <span class="stat-label">Cash</span>
            <span class="stat-value">$8,234.12</span>
          </div>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div class="sidebar-section chatbot-quickactions">
        <h3 data-translate="chatbot.sidebar.quickactions">Quick Actions</h3>
        <div id="chatbot-quickactions" class="quick-actions">
          <button class="quick-action-btn">ğŸ“Š Portfolio Summary</button>
          <button class="quick-action-btn">ğŸ’° Check Balance</button>
          <button class="quick-action-btn">ğŸ“ˆ Recent Trades</button>
          <button class="quick-action-btn">âš ï¸ Alerts</button>
        </div>
      </div>
      
      <!-- Settings -->
      <div class="sidebar-section chatbot-settings">
        <h3 data-translate="chatbot.sidebar.settings">Settings</h3>
        <div id="chatbot-settings" class="settings-list">
          <button class="setting-item">ğŸ”” Notifications</button>
          <button class="setting-item">ğŸ¨ Theme</button>
          <button class="setting-item">ğŸ”’ Privacy</button>
        </div>
      </div>
    </aside>

    <main class="chatbot-main">
      <!-- Welcome Screen -->
      <section class="chatbot-welcome" id="chatbot-welcome">
        <div class="welcome-content">
          <div class="welcome-icon">
            <img src="bubble-logo-single.svg" alt="Bubble AI" class="welcome-logo" />
          </div>
          <h2 data-translate="chatbot.welcome.title">Welcome to Your AI Investment Assistant</h2>
          <p data-translate="chatbot.welcome.description">
            I'm your personal AI portfolio manager. Ask me about your investments, 
            recent trades, market positions, or any questions about your financial portfolio.
          </p>
          <div class="welcome-features">
            <div class="feature-item">
              <span class="feature-icon">ğŸ“Š</span>
              <span>Real-time Portfolio Analysis</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">ğŸ¤–</span>
              <span>AI-Powered Insights</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">ğŸ”’</span>
              <span>Secure & Private</span>
            </div>
          </div>
          <button id="start-chat-btn" class="chatbot-start-btn" data-translate="chatbot.welcome.start">Start Managing Your Portfolio</button>
        </div>
      </section>

      <!-- Enhanced Chat Container -->
      <section class="chatbot-chat-container" id="chatbot-chat-container" style="display:none;">
        <!-- Chat Messages Area -->
        <div class="chatbot-message-list" id="chatbot-message-list">
          <!-- Messages will be populated by JavaScript -->
        </div>
        
        <!-- Enhanced Input Area -->
        <div class="chatbot-input-area">
          <!-- Investment-focused suggestions -->
          <div class="chatbot-suggestions" id="chatbot-suggestions">
            <!-- Suggestion buttons will be populated by JavaScript -->
          </div>
          
          <div class="chatbot-input-row">
            <div class="input-container">
              <input 
                type="text" 
                class="chatbot-input" 
                id="chatbot-input" 
                placeholder="Ask about your portfolio performance..." 
                data-translate="chat.placeholder" 
                aria-label="Ask about your investments" 
                autocomplete="off" 
              />
              <div class="input-status">
                <span class="typing-indicator" style="display: none;">
                  <span></span>
                  <span></span>
                  <span></span>
                </span>
              </div>
            </div>
            <button class="chatbot-send-btn" id="chatbot-send-btn" aria-label="Send">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 10L12 3L19 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 21V4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
          
          <!-- Quick Action Shortcuts -->
          <div class="quick-shortcuts">
            <button class="shortcut-btn" data-query="What's my portfolio performance today?">ğŸ“Š Performance</button>
            <button class="shortcut-btn" data-query="Show me my Bitcoin position">â‚¿ Bitcoin</button>
            <button class="shortcut-btn" data-query="What's my cash balance?">ğŸ’° Cash</button>
            <button class="shortcut-btn" data-query="Any recent trades?">ğŸ“ˆ Trades</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Waitlist Modal -->
  <div id="waitlist-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Join the Bubble Waitlist</h3>
        <button class="modal-close" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <p>Get early access to Bubble's AI investment platform.</p>
        <form id="waitlist-form-modal">
          <input type="email" placeholder="Enter your email" required />
          <button type="submit" class="btn-primary">Join Waitlist</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Enhanced initialization and modal functionality
    document.addEventListener('DOMContentLoaded', () => {
      // Quick shortcuts functionality
      document.querySelectorAll('.shortcut-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const query = btn.getAttribute('data-query');
          const input = document.getElementById('chatbot-input');
          input.value = query;
          input.focus();
        });
      });

      // Quick actions in sidebar
      document.querySelectorAll('.quick-action-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const input = document.getElementById('chatbot-input');
          const queries = {
            'ğŸ“Š Portfolio Summary': 'Give me a complete portfolio summary',
            'ğŸ’° Check Balance': 'What\'s my current cash balance?',
            'ğŸ“ˆ Recent Trades': 'Show me my recent trades this week',
            'âš ï¸ Alerts': 'Do I have any important alerts?'
          };
          input.value = queries[btn.textContent] || btn.textContent;
          input.focus();
        });
      });

      // Waitlist modal functionality
      const joinWaitlistBtn = document.getElementById('join-waitlist-btn');
      const learnMoreBtn = document.getElementById('learn-more-btn');
      const waitlistModal = document.getElementById('waitlist-modal');
      const modalClose = document.querySelector('.modal-close');

      if (joinWaitlistBtn) {
        joinWaitlistBtn.addEventListener('click', () => {
          waitlistModal.style.display = 'flex';
        });
      }

      if (learnMoreBtn) {
        learnMoreBtn.addEventListener('click', () => {
          // Link to main website or open info modal
          window.open('https://your-bubble-website.com', '_blank');
        });
      }

      if (modalClose) {
        modalClose.addEventListener('click', () => {
          waitlistModal.style.display = 'none';
        });
      }

      // Close modal on outside click
      waitlistModal?.addEventListener('click', (e) => {
        if (e.target === waitlistModal) {
          waitlistModal.style.display = 'none';
        }
      });

      // Waitlist form submission
      const waitlistForm = document.getElementById('waitlist-form-modal');
      if (waitlistForm) {
        waitlistForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = e.target.querySelector('input[type="email"]').value;
          
          try {
            const response = await fetch('/api/waitlist', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, source: 'chatbot_app' })
            });
            
            if (response.ok) {
              alert('Successfully joined the waitlist!');
              waitlistModal.style.display = 'none';
            } else {
              alert('Failed to join waitlist. Please try again.');
            }
          } catch (error) {
            alert('Network error. Please try again.');
          }
        });
      }

      // Mobile sidebar toggle
      const sidebarToggle = document.createElement('button');
      sidebarToggle.className = 'sidebar-toggle';
      sidebarToggle.innerHTML = 'â˜°';
      sidebarToggle.setAttribute('aria-label', 'Toggle sidebar');
      document.querySelector('.chatbot-header .header-left').appendChild(sidebarToggle);

      sidebarToggle.addEventListener('click', () => {
        document.getElementById('chatbot-sidebar').classList.toggle('mobile-visible');
      });
    });
  </script>
</body>
</html>